<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hemicycle US House Members 2025 with Clickable Seats and Search</title>
<style>
  body {
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
    background: #f0f0f0;
    font-family: Arial, sans-serif;
    margin: 0;
  }
  #search-container {
    margin: 15px 0;
  }
  #search-input {
    font-size: 14px;
    margin:0px;
    padding: 6px 8px;
    width: 300px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  #clear-search {
    margin-left: 8px;
    padding: 6px 10px;
    font-size: 14px;
    cursor: pointer;
    border-radius: 4px;
    border: 1px solid #ccc;
    background: white;
  }
  .hemicycle {
    position: relative;
    height: 375px;
    margin-bottom: 20px;
  }
  .seat {
    position: absolute;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    border: 2px solid white;
    box-shadow: 0 0 3px rgba(0,0,0,0.3);
    transform: translate(-50%, -50%);
    cursor: pointer;
    transition: opacity 0.3s;
  }
  .democrat {
    background: #0074D9; /* blue */
  }
  .republican {
    background: #FF4136; /* red */
  }
  .vacant {
    background: #AAAAAA; /* gray */
  }
  .highlight {
    box-shadow: 0 0 10px 3px yellow;
    border-color: gold;
    z-index: 10;
  }
  /* Tooltip container */
  .tooltip {
    position: absolute;
    background: rgba(50,50,50,0.9);
    color: white;
    padding: 6px 8px;
    border-radius: 4px;
    font-size: 12px;
    pointer-events: none;
    white-space: nowrap;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.2s;
  }
  .summary {
    font-size: 16px;
    font-weight: bold;
  }
  #header{
    margin: 10px 0px 0px 0px;
  }
  #state-options, #party-options {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0; /* match width of input */
    max-height: 500px;
    overflow-y: auto;
    border: 1px solid #ccc;
    border-top: none;
    background: white;
    z-index: 1000;
    display: none; /* hidden by default */
  }
</style>
</head>
<body>
<h1 id="header">USA Congress - House 2025 - 119th Congress</h1>
<div id="search-container">
  <input type="text" id="search-input" placeholder="Search representative by name..." />
  <button id="clear-search">Clear/Reset Filter</button>
</div>
  <table style="width: 100%; table-layout: fixed;">
    <tr style="vertical-align: top;">
      <td style="width: 10%; padding: 10px; position: relative;">
        <label for="state-select">Select or type a state:</label><br />
        <input type="text" id="state-select" placeholder="Start typing a state..." autocomplete="off"
               style="width: 100%; box-sizing: border-box; padding: 6px 8px; border-radius: 4px; border: 1px solid #ccc; font-size: 14px;" />
        <div id="state-options" style="top: 60px; left: 10px; width: 92%;"></div>
        <label for="party-select" style="margin-top:8px; display:block;">Select or type a party:</label>
        <input type="text" id="party-select" placeholder="Start typing a party..." autocomplete="off"
               style="width: 100%; box-sizing: border-box; padding: 6px 8px; border-radius: 4px; border: 1px solid #ccc; font-size: 14px;" />
        <div id="party-options" style="top: 115px; left: 10px; width: 92%;"></div>
      </td>    
      <td style="width: 50%; text-align: center;">
        <div class="hemicycle" id="hemicycle" style="margin: 0 auto;"></div>
        <div class="tooltip" id="tooltip"></div>
        <br>
        <div class="summary" id="summary"></div>
      </td>
    </tr>
  </table>
<script>
  // State dropdown logic
  (function() {
    const states = [
      "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware",
      "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky",
      "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi",
      "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico",
      "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania",
      "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont",
      "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"
    ];
    const abbreviations = {
      AL: "Alabama", AK: "Alaska", AZ: "Arizona", AR: "Arkansas", CA: "California",
      CO: "Colorado", CT: "Connecticut", DE: "Delaware", FL: "Florida", GA: "Georgia",
      HI: "Hawaii", ID: "Idaho", IL: "Illinois", IN: "Indiana", IA: "Iowa",
      KS: "Kansas", KY: "Kentucky", LA: "Louisiana", ME: "Maine", MD: "Maryland",
      MA: "Massachusetts", MI: "Michigan", MN: "Minnesota", MS: "Mississippi", MO: "Missouri",
      MT: "Montana", NE: "Nebraska", NV: "Nevada", NH: "New Hampshire", NJ: "New Jersey",
      NM: "New Mexico", NY: "New York", NC: "North Carolina", ND: "North Dakota", OH: "Ohio",
      OK: "Oklahoma", OR: "Oregon", PA: "Pennsylvania", RI: "Rhode Island", SC: "South Carolina",
      SD: "South Dakota", TN: "Tennessee", TX: "Texas", UT: "Utah", VT: "Vermont",
      VA: "Virginia", WA: "Washington", WV: "West Virginia", WI: "Wisconsin", WY: "Wyoming"
    };
    const stateInput = document.getElementById('state-select');
    const stateOptionsContainer = document.getElementById('state-options');
    function getAllStateOptions() {
      const combined = [];
      for (const [abbr, full] of Object.entries(abbreviations)) {
        combined.push(`${abbr} - ${full}`);
      }
      return combined;
    }
    function showStateOptions(filtered) {
      stateOptionsContainer.innerHTML = '';
      filtered.forEach(item => {
        const div = document.createElement('div');
        div.textContent = item;
        div.style.padding = '6px 8px';
        div.style.cursor = 'pointer';
        div.addEventListener('mousedown', () => {
          const abbr = item.split(' - ')[0];
          if (abbreviations[abbr]) {
            stateInput.value = abbreviations[abbr];
            stateOptionsContainer.style.display = 'none';
            filterSeats();
          }
        });
        div.addEventListener('mouseover', () => {
          div.style.background = '#0074D9';
          div.style.color = 'white';
        });
        div.addEventListener('mouseout', () => {
          div.style.background = 'white';
          div.style.color = 'black';
        });
        stateOptionsContainer.appendChild(div);
      });
      stateOptionsContainer.style.display = filtered.length ? 'block' : 'none';
    }
    stateInput.addEventListener('input', () => {
      const val = stateInput.value.trim().toLowerCase();
      if (!val) {
        showStateOptions(getAllStateOptions());
        filterSeats();
        return;
      }
      const filtered = getAllStateOptions().filter(item => {
        const [abbr, full] = item.split(' - ');
        return abbr.toLowerCase().startsWith(val) || full.toLowerCase().startsWith(val);
      });
      showStateOptions(filtered);
      filterSeats();
    });
    stateInput.addEventListener('focus', () => {
      showStateOptions(getAllStateOptions());
    });
    stateInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const val = stateInput.value.trim().toUpperCase();
        if (abbreviations[val]) {
          stateInput.value = abbreviations[val];
          stateOptionsContainer.style.display = 'none';
          filterSeats();
          e.preventDefault();
        }
      }
    });
    document.addEventListener('click', (e) => {
      if (!stateInput.contains(e.target) && !stateOptionsContainer.contains(e.target)) {
        stateOptionsContainer.style.display = 'none';
      }
    });
  })();
  // Party dropdown logic
  (function() {
    const parties = ["Democrat", "Republican", "Vacant"];
    const partyInput = document.getElementById('party-select');
    const partyOptionsContainer = document.getElementById('party-options');
    function showPartyOptions(filtered) {
      partyOptionsContainer.innerHTML = '';
      filtered.forEach(item => {
        const div = document.createElement('div');
        div.textContent = item;
        div.style.padding = '6px 8px';
        div.style.cursor = 'pointer';
        div.addEventListener('mousedown', () => {
          partyInput.value = item;
          partyOptionsContainer.style.display = 'none';
          filterSeats();
        });
        div.addEventListener('mouseover', () => {
          div.style.background = '#0074D9';
          div.style.color = 'white';
        });
        div.addEventListener('mouseout', () => {
          div.style.background = 'white';
          div.style.color = 'black';
        });
        partyOptionsContainer.appendChild(div);
      });
      partyOptionsContainer.style.display = filtered.length ? 'block' : 'none';
    }
    partyInput.addEventListener('input', () => {
      const val = partyInput.value.trim().toLowerCase();
      if (!val) {
        showPartyOptions(parties);
        filterSeats();
        return;
      }
      const filtered = parties.filter(p => p.toLowerCase().startsWith(val));
      showPartyOptions(filtered);
      filterSeats();
    });
    partyInput.addEventListener('focus', () => {
      showPartyOptions(parties);
    });
    partyInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const val = partyInput.value.trim();
        if (parties.includes(val)) {
          partyInput.value = val;
          partyOptionsContainer.style.display = 'none';
          filterSeats();
          e.preventDefault();
        }
      }
    });
    document.addEventListener('click', (e) => {
      if (!partyInput.contains(e.target) && !partyOptionsContainer.contains(e.target)) {
        partyOptionsContainer.style.display = 'none';
      }
    });
  })();
  const hemicycle = document.getElementById('hemicycle');
  const tooltip = document.getElementById('tooltip');
  const summary = document.getElementById('summary');
  const searchInput = document.getElementById('search-input');
  const clearSearchBtn = document.getElementById('clear-search');
  const stateInput = document.getElementById('state-select');
  const partyInput = document.getElementById('party-select');
  const numberOfRows = 11;
  const startRadius = 110;
  const rowGap = 25;
  const votingStates = new Set([
    "AL","AK","AZ","AR","CA","CO","CT","DE","FL","GA","HI","ID","IL","IN","IA",
    "KS","KY","LA","ME","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ",
    "NM","NY","NC","ND","OH","OK","OR","PA","RI","SC","SD","TN","TX","UT","VT",
    "VA","WA","WV","WI","WY"
  ]);
  function partyClass(party) {
    switch(party) {
      case 'Democrat': return 'democrat';
      case 'Republican': return 'republican';
      default: return 'vacant';
    }
  }
  let houseMembers = [];
  let seatElements = [];
	fetch('https://unitedstates.github.io/congress-legislators/legislators-current.json')
	  .then(response => response.json())
	  .then(data => {
		const currentDate = new Date();

		// ONLY change this filtering step to exclude any member whose LAST TERM is NOT HOUSE
		houseMembers = data.filter(member => {
		  if (!member.terms || member.terms.length === 0) return false;
		  const lastTerm = member.terms[member.terms.length - 1];
		  return lastTerm.type === "rep" &&
				 (!lastTerm.end || new Date(lastTerm.end) > currentDate) &&
				 votingStates.has(lastTerm.state);
		});

		// The rest remains your original code unchanged
		houseMembers.sort((a,b) => {
		  const aTerm = a.terms[a.terms.length - 1];
		  const bTerm = b.terms[b.terms.length - 1];
		  if(aTerm.state === bTerm.state) {
			return (aTerm.district || 0) - (bTerm.district || 0);
		  } else {
			return aTerm.state.localeCompare(bTerm.state);
		  }
		});
		drawHemicycle();
		updateSummary();
	  })
	  .catch(err => {
		console.error("Failed to load legislators data:", err);
		hemicycle.innerText = "Failed to load data.";
	  });
  function drawHemicycle() {
    hemicycle.innerHTML = '';
    seatElements = [];
    const totalSeats = houseMembers.length;
    const radii = [];
    for(let i=0; i<numberOfRows; i++) {
      radii.push(startRadius + i * rowGap);
    }
    const arcLengths = radii.map(r => Math.PI * r);
    const totalArcLength = arcLengths.reduce((a,b) => a+b, 0);
    let seatsPerRow = arcLengths.map(arc => Math.round((arc / totalArcLength) * totalSeats));
    let seatDifference = seatsPerRow.reduce((a,b) => a+b, 0) - totalSeats;
    while(seatDifference !== 0) {
      for(let i=0; i<seatsPerRow.length && seatDifference !== 0; i++) {
        if(seatDifference > 0 && seatsPerRow[i] > 1) {
          seatsPerRow[i]--;
          seatDifference--;
        } else if(seatDifference < 0) {
          seatsPerRow[i]++;
          seatDifference++;
        }
      }
    }
    const centerX = hemicycle.clientWidth / 2;
    const centerY = hemicycle.clientHeight;
    let seatGlobalIndex = 0;
    for(let row=0; row < numberOfRows; row++) {
      const radius = radii[row];
      const seats = seatsPerRow[row];
      for(let seatIndex=0; seatIndex < seats; seatIndex++) {
        if(seatGlobalIndex >= totalSeats) break;
        const member = houseMembers[seatGlobalIndex];
        const lastTerm = member.terms[member.terms.length -1];
        const party = lastTerm.party;
        const partyCls = partyClass(party);
        const angle = Math.PI - seatIndex * Math.PI / (seats - 1);
        const x = centerX + radius * Math.cos(angle);
        const y = centerY - radius * Math.sin(angle);
        const seat = document.createElement('div');
        seat.className = 'seat ' + partyCls;
        seat.style.left = x + 'px';
        seat.style.top = y + 'px';
        seat.title = `${member.name.first} ${member.name.last} (${party})`;
        seat.addEventListener('click', () => {
          const state = lastTerm.state;
          const district = lastTerm.district;
          const fileName = district && district !== 0 ? `house.html?${state}-${district}` : `${state}.html`;
          window.location.href = fileName;
        });
        seat.addEventListener('mouseenter', () => showTooltip(seat, member));
        seat.addEventListener('mouseleave', hideTooltip);
        hemicycle.appendChild(seat);
        seatElements.push({seat, member});
        seatGlobalIndex++;
      }
    }
  }
  function showTooltip(seat, member) {
    const lastTerm = member.terms[member.terms.length -1];
    tooltip.style.opacity = '1';
    tooltip.innerText = `${member.name.first} ${member.name.last}\n${lastTerm.party}\n${lastTerm.state}-${lastTerm.district || 'At Large'}`;
    const rect = seat.getBoundingClientRect();
    const bodyRect = document.body.getBoundingClientRect();
    tooltip.style.left = `${rect.left + rect.width/2 - bodyRect.left}px`;
    tooltip.style.top = `${rect.top - bodyRect.top - 30}px`;
  }
  function hideTooltip() {
    tooltip.style.opacity = '0';
  }
  function updateSummary() {
    let demCount=0, repCount=0, vacantCount=0;
    houseMembers.forEach(member => {
      const lastTerm = member.terms[member.terms.length - 1];
      const party = lastTerm.party;
      if(party === 'Democrat') demCount++;
      else if(party === 'Republican') repCount++;
      else vacantCount++;
    });
    summary.textContent = `Republicans: ${repCount} — Democrats: ${demCount} — Vacant: ${vacantCount}`;
  }
  function filterSeats() {
    const partyFilterText = partyInput.value.trim().toLowerCase();
    const stateFilterText = stateInput.value.trim().toUpperCase();
    // Map for full state name to 2-letter code
    const stateNameToCode = {
      "ALABAMA": "AL", "ALASKA": "AK", "ARIZONA": "AZ", "ARKANSAS": "AR",
      "CALIFORNIA": "CA", "COLORADO": "CO", "CONNECTICUT": "CT", "DELAWARE": "DE",
      "FLORIDA": "FL", "GEORGIA": "GA", "HAWAII": "HI", "IDAHO": "ID",
      "ILLINOIS": "IL", "INDIANA": "IN", "IOWA": "IA", "KANSAS": "KS",
      "KENTUCKY": "KY", "LOUISIANA": "LA", "MAINE": "ME", "MARYLAND": "MD",
      "MASSACHUSETTS": "MA", "MICHIGAN": "MI", "MINNESOTA": "MN", "MISSISSIPPI": "MS",
      "MISSOURI": "MO", "MONTANA": "MT", "NEBRASKA": "NE", "NEVADA": "NV",
      "NEW HAMPSHIRE": "NH", "NEW JERSEY": "NJ", "NEW MEXICO": "NM", "NEW YORK": "NY",
      "NORTH CAROLINA": "NC", "NORTH DAKOTA": "ND", "OHIO": "OH", "OKLAHOMA": "OK",
      "OREGON": "OR", "PENNSYLVANIA": "PA", "RHODE ISLAND": "RI", "SOUTH CAROLINA": "SC",
      "SOUTH DAKOTA": "SD", "TENNESSEE": "TN", "TEXAS": "TX", "UTAH": "UT",
      "VERMONT": "VT", "VIRGINIA": "VA", "WASHINGTON": "WA", "WEST VIRGINIA": "WV",
      "WISCONSIN": "WI", "WYOMING": "WY"
    };
    let stateFilter = "";
    if(stateFilterText.length === 2 && votingStates.has(stateFilterText)) {
      stateFilter = stateFilterText;
    } else if(stateNameToCode[stateFilterText]) {
      stateFilter = stateNameToCode[stateFilterText];
    }
    const nameFilter = searchInput.value.toLowerCase().trim();
    seatElements.forEach(({seat, member}) => {
      const lastTerm = member.terms[member.terms.length -1];
      const memberParty = (lastTerm.party || '').toLowerCase();
      const partyMatch = !partyFilterText || memberParty === partyFilterText;
      const memberState = lastTerm.state.toUpperCase();
      const fullName = (member.name.first + ' ' + member.name.last).toLowerCase();
      const stateMatch = !stateFilter || memberState === stateFilter;
      const nameMatch = !nameFilter || fullName.includes(nameFilter);
      if(stateMatch && nameMatch && partyMatch) {
        seat.style.opacity = '1';
        seat.classList.remove('highlight');
      } else {
        seat.style.opacity = '0.15';
        seat.classList.remove('highlight');
      }
    });
    if(nameFilter === '' && !stateFilter && !partyFilterText) return;
    let found = false;
    seatElements.forEach(({seat, member}) => {
      const lastTerm = member.terms[member.terms.length -1];
      const memberParty = (lastTerm.party || '').toLowerCase();
      const partyMatch = !partyFilterText || memberParty === partyFilterText;
      const memberState = lastTerm.state.toUpperCase();
      const fullName = (member.name.first + ' ' + member.name.last).toLowerCase();
      if(fullName === nameFilter && partyMatch && (!stateFilter || memberState === stateFilter)) {
        seat.style.opacity = '1';
        seat.classList.add('highlight');
        found = true;
      }
    });
    if(!found) {
      seatElements.forEach(({seat, member}) => {
        const lastTerm = member.terms[member.terms.length -1];
        const memberParty = (lastTerm.party || '').toLowerCase();
        const partyMatch = !partyFilterText || memberParty === partyFilterText;
        const memberState = lastTerm.state.toUpperCase();
        const fullName = (member.name.first + ' ' + member.name.last).toLowerCase();
        if(fullName.includes(nameFilter) && partyMatch && (!stateFilter || memberState === stateFilter)) {
          seat.classList.add('highlight');
        }
      });
    }
  }
  searchInput.addEventListener('input', () => {
    filterSeats();
  });
  stateInput.addEventListener('input', () => {
    filterSeats();
  });
  partyInput.addEventListener('input', () => {
    filterSeats();
  });
  clearSearchBtn.addEventListener('click', () => {
    searchInput.value = '';
    stateInput.value = '';
    partyInput.value = '';
    filterSeats();
  });
  window.addEventListener('scroll', hideTooltip);
  window.addEventListener('click', hideTooltip);
</script>
</body>
</html>
